"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.virtualFs = void 0;
const path_1 = require("@stoplight/path");
const virtualFs = ({ fs }) => {
    const recognized = new WeakMap();
    return {
        name: '@stoplight-spectral/virtual-fs',
        resolveId(source, importer) {
            const { protocol } = (0, path_1.parse)(source);
            if (protocol === 'http' || protocol === 'https') {
                return null;
            }
            if (protocol !== 'file' && !/^[./]/.test(source)) {
                return null;
            }
            let resolvedSource = source;
            if ((0, path_1.isAbsolute)(source)) {
                resolvedSource = (0, path_1.normalize)(source);
            }
            else if (importer !== void 0) {
                resolvedSource = (0, path_1.join)((0, path_1.dirname)(importer), source);
            }
            let existingEntries = recognized.get(this);
            if (existingEntries === void 0) {
                existingEntries = [];
                recognized.set(this, existingEntries);
            }
            existingEntries.push(resolvedSource);
            return resolvedSource;
        },
        load(id) {
            var _a;
            if (!(0, path_1.isURL)(id) && ((_a = recognized.get(this)) === null || _a === void 0 ? void 0 : _a.includes(id)) === true) {
                return fs.promises.readFile(id, 'utf8');
            }
            return;
        },
    };
};
exports.virtualFs = virtualFs;
//# sourceMappingURL=virtualFs.js.map